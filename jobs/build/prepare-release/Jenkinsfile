import java.text.SimpleDateFormat

node {
    wrap([$class: "BuildUser"]) {
        checkout scm
        def buildlib = load("pipeline-scripts/buildlib.groovy")
        def commonlib = buildlib.commonlib

        def dateFormat = new SimpleDateFormat("yyyy-MMM-dd")
        def date = new Date()

        commonlib.describeJob("⛔❌⛔ prepare-release (deprecated) ⛔❌⛔ ", """
            <b>Deprecated. Use <a href="https://console-openshift-console.apps.ocp4.prod.psi.redhat.com/k8s/ns/art-cd/tekton.dev~v1beta1~Pipeline/prepare-release">Tekton job prepare-release</a> instead</b>
            <h2>This job will perform an assortment of release tasks for creating a release from scratch.</h2>
            <b>Timing</b>: On the prepare-the-release day (Monday).
        """)

        properties(
            [
                disableResume(),
                buildDiscarder(
                    logRotator(
                        artifactDaysToKeepStr: "",
                        artifactNumToKeepStr: "",
                        daysToKeepStr: "",
                        numToKeepStr: "")),
                [
                    $class: "ParametersDefinitionProperty",
                    parameterDefinitions: [
                        commonlib.ocpVersionParam('VERSION'),
                        string(
                            name: "ASSEMBLY",
                            description: "The name of an assembly; must be defined in releases.yml (e.g. 4.9.1)",
                            defaultValue: "stream",
                            trim: true
                        ),
                        string(
                            name: "NAME",
                            description: "The expected release name (e.g. 4.6.42); Do not specify for a non-stream assembly.",
                            trim: true
                        ),
                        string(
                            name: "DATE",
                            description: "Intended release date. Format: YYYY-Mon-dd (example: 2050-Jan-01)",
                            defaultValue: "${dateFormat.format(date)}",
                            trim: true
                        ),
                        string(
                            name: "NIGHTLIES",
                            description: "(Optional for 3.y.z) list of proposed nightlies for each arch, separated by comma; Do not specify for a non-stream assembly (nightlies should be in releases.yml)",
                            trim: true
                        ),
                        string(
                            name: "PACKAGE_OWNER",
                            description: "(Optional) Must be an individual email address; may be anyone who wants random advisory spam",
                            defaultValue: "lmeyer@redhat.com",
                            trim: true
                        ),
                        booleanParam(
                            name: "DEFAULT_ADVISORIES",
                            description: "Do not create advisories/jira; pick them up from ocp-build-data; Do not specify for a non-stream assembly (advisories should be in releases.yml)",
                            defaultValue: false
                        ),
                        booleanParam(
                            name: "DRY_RUN",
                            description: "Take no action, just echo what the job would have done.",
                            defaultValue: false
                        ),
                        commonlib.mockParam(),
                    ]
                ],
            ]
        )   // Please update README.md if modifying parameter names or semantics

        commonlib.checkMock()
        error("This job has been deprecated. Please use the Tekton version instead.")

    }
}
